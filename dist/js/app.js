var NeighborhoodMap=function(){function e(){u=new google.maps.Map($(".map").get(0),{center:{lat:37.386052,lng:-122.083851},zoom:14}),ko.applyBindings(NeighborhoodMap)}function o(){ko.applyBindings(NeighborhoodMap),h("<h1>Google Map error!!!</h1><p>Something went wrong with the Google map API request.\nPlease refresh your browser ,try again letter or check your internet connection.</p>"),m(!1)}function n(e){l="https://api.foursquare.com/v2/venues/explore?near=Mountain View, CA&query=pizza&limit=10&oauth_token=50XUH2ZKED4X4GSRF4EOR0LW4EF0R1IUC1USVIABIYXEMXP5&v=20160321",$.ajax({url:l,dataType:"jsonp",success:function(o){e(o)},error:function(e,o,n){h("<h1>Oops!!! "+e.status+" error</h1><p>Something went wrong with the foursquare API request.\nPlease refresh your browser ,try again letter or check your internet connection.</p>"),m(!1)}})}function r(e){var o=e.response.groups[0].items,n=new google.maps.LatLngBounds,r="https://foursquare.com/v/";o.forEach(function(e,o){p.push({tip:e.tips[0].text,name:e.venue.name,phone:e.venue.contact.formattedPhone,twitter:e.venue.contact.twitter,address:e.venue.location.formattedAddress[0],rating:e.venue.rating,url:r+e.venue.id,lat:e.venue.location.lat,lng:e.venue.location.lng,marker:new google.maps.Marker({position:{lat:e.venue.location.lat,lng:e.venue.location.lng},title:e.venue.name,animation:google.maps.Animation.DROP,map:u,draggable:!1})}),n.extend(p()[o].marker.getPosition())}),u.fitBounds(n),google.maps.event.addDomListener(window,"resize",function(){var e=u.getCenter();google.maps.event.trigger(u,"resize"),u.setCenter(e),u.fitBounds(n)}),ko.utils.arrayForEach(p(),function(e){google.maps.event.addListener(e.marker,"click",function(){a&&a!==e.marker&&a.setAnimation(null),i&&i.close(),c(e),e.marker.setAnimation(google.maps.Animation.BOUNCE),a=e.marker,i=new google.maps.InfoWindow({content:"<div><h1>"+e.name+'</h1><p class="tip">'+e.tip+'</p><ul><li><span class="bold-text">RATING:</span> '+e.rating+'</li><li><span class="bold-text">ADDRESS:</span> '+e.address+'</li><li><span class="bold-text">TEL:</span> '+e.phone+'</li><li><a href="'+e.url+'" target="_blank">View on Foursquare</li></div></ul>'}),i.open(u,e.marker),u.setCenter(e.marker.getPosition()),u.setZoom(16)})})}function t(e){c(e),google.maps.event.trigger(c().marker,"click")}var a,i,s,l,u,p=ko.observableArray(),c=ko.observable(""),g=ko.observable(""),m=ko.observable(!0),h=ko.observable();return n(r),s=ko.computed(function(){var e=[],o=[];return ko.utils.arrayFilter(p(),function(n){return n.name.toLowerCase().indexOf(g().toLowerCase())<0?(e.push(n),void e.forEach(function(e){e.marker.setMap(null)})):(o.push(n),o.forEach(function(e){e.marker.setMap(u)}),0===g().length||n.name.toLowerCase().indexOf(g().toLowerCase())>-1)})}),{searched:s,chosenPlace:c,placeClick:t,query:g,initMap:e,apiError:m,errorMessage:h,googleError:o}}();